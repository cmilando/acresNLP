# write_tsv(combined_table, 'combined_table_v8_final.tsv')
# ----------------------------------------------------------------------------
### make flowchart
nrow(combined_table)
# 27 Original from
##
combined_table <- combined_table %>% filter(!towns_to_scrub)
nrow(combined_table)
table(combined_table$duplicated)
table(combined_table %>%
filter(duplicated == F) %>% select(is_MASS))
table(combined_table %>%
filter(duplicated == F, is_MASS == T) %>%
select(is_INNER_CORE))
table(combined_table %>%
filter(duplicated == F, is_MASS == T, is_INNER_CORE == T) %>%
select(has_climate))
table(combined_table %>%
filter(duplicated == F, is_MASS == T, is_INNER_CORE == T,
has_climate == 1) %>%
select(has_community))
table(combined_table %>%
filter(duplicated == F, is_MASS == T, is_INNER_CORE == T,
has_climate == 1, has_community == 1) %>%
select(pass_checks3))
combined_table <- combined_table %>%
mutate(pass_checks4 = duplicated == F & is_MASS == T &
is_INNER_CORE == T &
has_climate == 1 & has_community == 1 & pass_checks3)
table(combined_table$pass_checks4)
# ----------------------------------------------------------------------------
#90% or over for all towns
combined_table_relevant <- combined_table %>%
filter(pass_checks4)
nrow(combined_table_relevant)
#
# combined_table %>%
#   filter(duplicated == F, is_MASS == T, is_INNER_CORE == T,
#          has_climate == 1, has_community == 1)
dim(combined_table_relevant)
write_tsv(combined_table_relevant, 'combined_table_relevant_v10.tsv')
source("01_make_passchecks.R")
dim(combined_table)
table(combined_table$most_common_town, combined_table$pass_checks2)
table(combined_table$pass_checks2)
mancx <- read.csv(paste0(my_dir, "manual_checks_1202.csv"), header = T,
sep = "|")
head(mancx)
combined_table <- combined_table %>% left_join(mancx)
dim(combined_table)
data.frame(head(combined_table))
combined_table <- combined_table %>%
mutate(pass_checks3 = (
Manual.Check.11.19 %in% c("INCLUDE") &
duplicated == F &
(is_INNER_CORE == T | is_ACRES_town == T) &
is_MASS == T &
has_climate == 1 &
has_community == 1
))
# # malden 63
r1 <- which(combined_table$file_name == 'maldenurl63.json')
r1
combined_table$pass_checks3[r1] <- TRUE
# r1 <- which(combined_table$file_name == 'readingurl60.json')
# r1
# combined_table$pass_checks3[r1] <- TRUE
#
# # wilmington
# r1 <- which(combined_table$file_name == 'wilmingtonurl47.json')
# r1
# combined_table$pass_checks3[r1] <- TRUE
#
# # waltham 82
r1 <- which(combined_table$file_name == 'walthamurl82.json')
length(r1)
combined_table$pass_checks3[r1] <- TRUE
# and any with url that starts with https://www.mass.gov/doc/
r1 <- which(grepl("https://www.mass.gov/doc/", combined_table$url))
length(r1)
table(combined_table$pass_checks3[r1])
combined_table$pass_checks3[r1] <- TRUE
##
### WHICH ONE IS NONE
which(combined_table$most_common_town == 'None' &
combined_table$pass_checks3)
pass_checks <- combined_table %>%
filter(pass_checks3) %>%
group_by(most_common_town) %>% tally()
sum(pass_checks$n)
### make flowchart
nrow(combined_table)
##
combined_table <- combined_table %>% filter(!towns_to_scrub)
nrow(combined_table)
table(combined_table$duplicated)
table(combined_table %>%
filter(duplicated == F) %>% select(is_MASS))
table(combined_table %>%
filter(duplicated == F, is_MASS == T) %>%
select(is_INNER_CORE))
table(combined_table %>%
filter(duplicated == F, is_MASS == T, is_INNER_CORE == T) %>%
select(has_climate))
table(combined_table %>%
filter(duplicated == F, is_MASS == T, is_INNER_CORE == T,
has_climate == 1) %>%
select(has_community))
table(combined_table %>%
filter(duplicated == F, is_MASS == T, is_INNER_CORE == T,
has_climate == 1, has_community == 1) %>%
select(pass_checks3))
combined_table <- combined_table %>%
mutate(pass_checks4 = duplicated == F & is_MASS == T &
is_INNER_CORE == T &
has_climate == 1 & has_community == 1 & pass_checks3)
table(combined_table$pass_checks4)
table(combined_table %>%
filter(duplicated == F, is_MASS == T, is_INNER_CORE == T,
has_climate == 1) %>%
select(has_community))
towns_to_scrub
dim(combined_table)
source("01_make_passchecks.R")
dim(combined_table)
table(combined_table$most_common_town, combined_table$pass_checks2)
table(combined_table$pass_checks2)
mancx <- read.csv(paste0(my_dir, "manual_checks_1202.csv"), header = T,
sep = "|")
head(mancx)
combined_table <- combined_table %>% left_join(mancx)
dim(combined_table)
data.frame(head(combined_table))
combined_table <- combined_table %>%
mutate(pass_checks3 = (
Manual.Check.11.19 %in% c("INCLUDE") &
duplicated == F &
(is_INNER_CORE == T | is_ACRES_town == T) &
is_MASS == T &
has_climate == 1 &
has_community == 1
))
# # malden 63
r1 <- which(combined_table$file_name == 'maldenurl63.json')
r1
combined_table$pass_checks3[r1] <- TRUE
# r1 <- which(combined_table$file_name == 'readingurl60.json')
# r1
# combined_table$pass_checks3[r1] <- TRUE
#
# # wilmington
# r1 <- which(combined_table$file_name == 'wilmingtonurl47.json')
# r1
# combined_table$pass_checks3[r1] <- TRUE
#
# # waltham 82
r1 <- which(combined_table$file_name == 'walthamurl82.json')
length(r1)
combined_table$pass_checks3[r1] <- TRUE
# and any with url that starts with https://www.mass.gov/doc/
r1 <- which(grepl("https://www.mass.gov/doc/", combined_table$url))
length(r1)
table(combined_table$pass_checks3[r1])
combined_table$pass_checks3[r1] <- TRUE
##
### WHICH ONE IS NONE
which(combined_table$most_common_town == 'None' &
combined_table$pass_checks3)
pass_checks <- combined_table %>%
filter(pass_checks3) %>%
group_by(most_common_town) %>% tally()
sum(pass_checks$n)
### make flowchart
nrow(combined_table)
table(combined_table$duplicated)
head(combined_table)
##
combined_table <- combined_table %>% filter(is_INNER_CORE == T)
nrow(combined_table)
751 - 21*2
nrow(combined_table)
table(combined_table$duplicated)
# in MA
table(combined_table %>%
filter(duplicated == F) %>% select(is_MASS))
table(combined_table %>%
filter(duplicated == F, is_MASS == T, is_INNER_CORE == T) %>%
select(has_climate))
# in MA
table(combined_table %>%
filter(duplicated == F) %>% select(is_MASS))
# climate
table(combined_table %>%
filter(duplicated == F, is_MASS == T, is_INNER_CORE == T) %>%
select(has_climate))
# community
table(combined_table %>%
filter(duplicated == F, is_MASS == T, is_INNER_CORE == T,
has_climate == 1) %>%
select(has_community))
# pass checks
table(combined_table %>%
filter(duplicated == F, is_MASS == T, is_INNER_CORE == T,
has_climate == 1, has_community == 1) %>%
select(pass_checks3))
combined_table <- combined_table %>%
mutate(pass_checks4 = duplicated == F & is_MASS == T &
is_INNER_CORE == T &
has_climate == 1 & has_community == 1 & pass_checks3)
table(combined_table$pass_checks4)
# save the result
combined_table <- combined_table %>%
mutate(pass_checks4 = duplicated == F & is_MASS == T &
is_INNER_CORE == T &
has_climate == 1 & has_community == 1 & pass_checks3)
table(combined_table$pass_checks4)
# ----------------------------------------------------------------------------
#90% or over for all towns
combined_table_relevant <- combined_table %>%
filter(pass_checks4)
nrow(combined_table_relevant)
dim(combined_table_relevant)
write_tsv(combined_table_relevant, 'combined_table_relevant_v10.tsv')
combined_tbl <- read_tsv("combined_table_relevant_v10.tsv")
# remove the winthrop unscannable
# combined_tbl <- xx %>% filter(file_name != 'winthropurl35.json' & pass_checks3 == T)
#
# View(combined_tbl %>%
#   filter(most_common_town == 'chelsea'))
MyRW_town <- read.table("MYRWA_towns.txt")
myrw_town <- tolower(MyRW_town$V1)
combined_tbl <- combined_tbl  %>% mutate(is_ACRES_town = most_common_town %in% myrw_town)
#### Supplemental Table 4 ####
sTab_4 <- combined_tbl %>% summarize(flood_n = length(which(flood_count > 0)),
flood_pct = length(which(flood_count > 0))/length(flood_count),
storm_n = length(which(storm_count > 0)),
storm_pct = length(which(storm_count > 0))/length(storm_count),
heat_n = length(which(heat_count > 0)),
heat_pct = length(which(heat_count > 0))/length(heat_count),
air_pollution_n = length(which(air_pollution_count > 0)),
air_pollution_pct = length(which(air_pollution_count > 0))/length(air_pollution_count),
indoor_air_quality_n = length(which(indoor_air_quality_count > 0)),
indoor_air_quality_pct = length(which(indoor_air_quality_count > 0))/length(indoor_air_quality_count),
chemical_hazards_n = length(which(chemical_hazards_count > 0)),
chemical_hazards_pct = length(which(chemical_hazards_count > 0))/length(chemical_hazards_count),
extreme_precipitation_n = length(which(extreme_precipitation_count > 0)),
extreme_precipitation_pct = length(which(extreme_precipitation_count > 0))/length(extreme_precipitation_count),
fire_n = length(which(fire_count > 0)),
fire_pct = length(which(fire_count > 0))/length(fire_count)) %>% pivot_longer()
library(tidyverse)
library(ggpubr)
library(lemon)
MyRW_town <- read.table("MYRWA_towns.txt")
myrw_town <- tolower(MyRW_town$V1)
combined_tbl <- combined_tbl  %>% mutate(is_ACRES_town = most_common_town %in% myrw_town)
#### Supplemental Table 4 ####
sTab_4 <- combined_tbl %>% summarize(flood_n = length(which(flood_count > 0)),
flood_pct = length(which(flood_count > 0))/length(flood_count),
storm_n = length(which(storm_count > 0)),
storm_pct = length(which(storm_count > 0))/length(storm_count),
heat_n = length(which(heat_count > 0)),
heat_pct = length(which(heat_count > 0))/length(heat_count),
air_pollution_n = length(which(air_pollution_count > 0)),
air_pollution_pct = length(which(air_pollution_count > 0))/length(air_pollution_count),
indoor_air_quality_n = length(which(indoor_air_quality_count > 0)),
indoor_air_quality_pct = length(which(indoor_air_quality_count > 0))/length(indoor_air_quality_count),
chemical_hazards_n = length(which(chemical_hazards_count > 0)),
chemical_hazards_pct = length(which(chemical_hazards_count > 0))/length(chemical_hazards_count),
extreme_precipitation_n = length(which(extreme_precipitation_count > 0)),
extreme_precipitation_pct = length(which(extreme_precipitation_count > 0))/length(extreme_precipitation_count),
fire_n = length(which(fire_count > 0)),
fire_pct = length(which(fire_count > 0))/length(fire_count)) %>% pivot_longer()
combined_tbl <- read_tsv("combined_table_relevant_v10.tsv")
sTab_4 <- combined_tbl %>% summarize(flood_n = length(which(flood_count > 0)),
flood_pct = length(which(flood_count > 0))/length(flood_count),
storm_n = length(which(storm_count > 0)),
storm_pct = length(which(storm_count > 0))/length(storm_count),
heat_n = length(which(heat_count > 0)),
heat_pct = length(which(heat_count > 0))/length(heat_count),
air_pollution_n = length(which(air_pollution_count > 0)),
air_pollution_pct = length(which(air_pollution_count > 0))/length(air_pollution_count),
indoor_air_quality_n = length(which(indoor_air_quality_count > 0)),
indoor_air_quality_pct = length(which(indoor_air_quality_count > 0))/length(indoor_air_quality_count),
chemical_hazards_n = length(which(chemical_hazards_count > 0)),
chemical_hazards_pct = length(which(chemical_hazards_count > 0))/length(chemical_hazards_count),
extreme_precipitation_n = length(which(extreme_precipitation_count > 0)),
extreme_precipitation_pct = length(which(extreme_precipitation_count > 0))/length(extreme_precipitation_count),
fire_n = length(which(fire_count > 0)),
fire_pct = length(which(fire_count > 0))/length(fire_count)) %>% pivot_longer()
library(tidyverse)
library(ggpubr)
library(lemon)
combined_tbl <- read_tsv("combined_table_relevant_v10.tsv")
sTab_4 <- combined_tbl %>% summarize(flood_n = length(which(flood_count > 0)),
flood_pct = length(which(flood_count > 0))/length(flood_count),
storm_n = length(which(storm_count > 0)),
storm_pct = length(which(storm_count > 0))/length(storm_count),
heat_n = length(which(heat_count > 0)),
heat_pct = length(which(heat_count > 0))/length(heat_count),
air_pollution_n = length(which(air_pollution_count > 0)),
air_pollution_pct = length(which(air_pollution_count > 0))/length(air_pollution_count),
indoor_air_quality_n = length(which(indoor_air_quality_count > 0)),
indoor_air_quality_pct = length(which(indoor_air_quality_count > 0))/length(indoor_air_quality_count),
chemical_hazards_n = length(which(chemical_hazards_count > 0)),
chemical_hazards_pct = length(which(chemical_hazards_count > 0))/length(chemical_hazards_count),
extreme_precipitation_n = length(which(extreme_precipitation_count > 0)),
extreme_precipitation_pct = length(which(extreme_precipitation_count > 0))/length(extreme_precipitation_count),
fire_n = length(which(fire_count > 0)),
fire_pct = length(which(fire_count > 0))/length(fire_count)) %>% pivot_longer()
head(combined_tbl)
library(cityHeatHealth)
library(sf)
data(ma_towns)
ggplot(ma_towns) +
geom_sf()
library(dplyr)
inner_core <- read.table("INNER_CORE.txt")
inner_core$V1
toupper(inner_core$V1)
head(ma_towns)
ICC <- ma_towns %>% filter(TOWN20 %in% toupper(inner_core$V1))
bb <- st_bbox(ICC)
ICC_crop <- st_crop(ma_towns, bb)
ggplot() +
geom_sf(data = ICC_crop) +
geom_sf(data = ICC, fill = 'red')
library(ggpubr)
ICC_centroids <- st_centroids(ICC)
ICC_centroids <- st_centroid(ICC)
ggplot() +
geom_sf(data = ICC_crop) +
geom_sf(data = ICC, fill = 'lavender') +
geom_sf(data = ICC_centroids,
mapping = aes(label = TOWN20))
ggplot() +
geom_sf(data = ICC_crop) +
geom_sf(data = ICC, fill = 'lavender') +
geom_text(data = ICC_centroids,
mapping = aes(label = TOWN20))
head(ICC_centroids)
ICC_centroids <- st_centroid(ICC) %>% st_drop_geometry()
head(ICC_centroids)
ICC_centroids <- st_centroid(ICC) %>% st_coordinates()
head(ICC_centroids)
ICC_centroids <- st_centroid(ICC) %>% st_geometry()
head(ICC_centroids)
ICC_centroids <- st_centroid(ICC)
head(ICC_centroids)
data.frame(head(ICC_centroids))
ICC_centroids <- st_centroid(ICC) %>% st_coordinates()
ICC_centroids$TOWN20 = ICC$TOWN20
head(ICC_centroids)
ICC_centroids <- st_centroid(ICC) %>% st_coordinates() %>%
data.frame()
ICC_centroids$TOWN20 = ICC$TOWN20
head(ICC_centroids)
ggplot() +
geom_sf(data = ICC_crop) +
geom_sf(data = ICC, fill = 'lavender') +
geom_text(data = ICC_centroids,
mapping = aes(x = X, y = Y, label = TOWN20))
ggplot() +
geom_sf(data = ICC_crop) +
geom_sf(data = ICC, fill = 'lavender') +
geom_label(data = ICC_centroids,
mapping = aes(x = X, y = Y, label = TOWN20))
ggplot() +
geom_sf(data = ICC_crop) +
geom_sf(data = ICC, fill = 'lavender') +
geom_label(data = ICC_centroids,
mapping = aes(x = X, y = Y, label = TOWN20),
size = 3)
ggplot() +
geom_sf(data = ICC_crop) +
geom_sf(data = ICC, fill = 'lavender') +
geom_label(data = ICC_centroids,
mapping = aes(x = X, y = Y, label = TOWN20),
size = 2)
ggplot() + theme_classic2() +
geom_sf(data = ICC_crop) +
geom_sf(data = ICC, fill = 'lavender') +
geom_label(data = ICC_centroids,
mapping = aes(x = X, y = Y, label = TOWN20),
size = 2)
library(ggspatial)
install.packages("ggspatial")
library(ggspatial)
ggplot() +
geom_sf(data = ICC_crop) +
geom_sf(data = ICC, fill = 'lavender') +
geom_label(data = ICC_centroids,
mapping = aes(x = X, y = Y, label = TOWN20),
size = 2) +
# Add Scale Bar (bottom right default)
annotation_scale(location = "br", width_hint = 0.5) +
# Add North Arrow (top right default)
annotation_north_arrow(location = "tr", which_north = "true",
style = north_arrow_fancy_orienteering) +
theme_void()
ggplot() +
geom_sf(data = ICC_crop) +
geom_sf(data = ICC, fill = 'lavender') +
geom_label(data = ICC_centroids,
mapping = aes(x = X, y = Y, label = TOWN20),
size = 2, fill = 'white') +
# Add Scale Bar (bottom right default)
annotation_scale(location = "br", width_hint = 0.5) +
# Add North Arrow (top right default)
annotation_north_arrow(location = "tr", which_north = "true",
style = north_arrow_fancy_orienteering) +
theme_void()
dev.size()
ggsave('map_v10.png', width = 7, height = 7, dpi = 300)
ggplot() + theme_classic2() +
geom_sf(data = ICC_crop) +
geom_sf(data = ICC, fill = 'lavender') +
geom_label(data = ICC_centroids,
mapping = aes(x = X, y = Y, label = TOWN20),
size = 2, fill = 'white') +
# Add Scale Bar (bottom right default)
annotation_scale(location = "br", width_hint = 0.5) +
# Add North Arrow (top right default)
annotation_north_arrow(location = "tr", which_north = "true",
style = north_arrow_fancy_orienteering)
ggplot() + theme_classic2() +
geom_sf(data = ICC_crop) +
geom_sf(data = ICC, fill = 'lavender') +
geom_label(data = ICC_centroids,
mapping = aes(x = X, y = Y, label = TOWN20),
size = 2, fill = 'white') +
# Add Scale Bar (bottom right default)
annotation_scale(location = "br", width_hint = 0.5) +
# Add North Arrow (top right default)
annotation_north_arrow(location = "tr", which_north = "true",
style = north_arrow_fancy_orienteering) +
theme(axis.lines = element_blank(),
axis.text = element_blank(),
axis.title = element_blank())
ggplot() + theme_classic2() +
geom_sf(data = ICC_crop) +
geom_sf(data = ICC, fill = 'lavender') +
geom_label(data = ICC_centroids,
mapping = aes(x = X, y = Y, label = TOWN20),
size = 2, fill = 'white') +
# Add Scale Bar (bottom right default)
annotation_scale(location = "br", width_hint = 0.5) +
# Add North Arrow (top right default)
annotation_north_arrow(location = "tr", which_north = "true",
style = north_arrow_fancy_orienteering) +
theme(axis.line = element_blank(),
axis.text = element_blank(),
axis.title = element_blank())
ggplot() + theme_classic2() +
geom_sf(data = ICC_crop) +
geom_sf(data = ICC, fill = 'lavender') +
geom_label(data = ICC_centroids,
mapping = aes(x = X, y = Y, label = TOWN20),
size = 2, fill = 'white') +
# Add Scale Bar (bottom right default)
annotation_scale(location = "br", width_hint = 0.5) +
# Add North Arrow (top right default)
annotation_north_arrow(location = "tr", which_north = "true",
style = north_arrow_fancy_orienteering) +
theme(axis.line = element_blank(),
axis.ticks = element_blank().
ggplot() + theme_classic2() +
geom_sf(data = ICC_crop) +
geom_sf(data = ICC, fill = 'lavender') +
geom_label(data = ICC_centroids,
mapping = aes(x = X, y = Y, label = TOWN20),
size = 2, fill = 'white') +
# Add Scale Bar (bottom right default)
annotation_scale(location = "br", width_hint = 0.5) +
# Add North Arrow (top right default)
annotation_north_arrow(location = "tr", which_north = "true",
style = north_arrow_fancy_orienteering) +
theme(axis.line = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
axis.title = element_blank())
ggplot() + theme_classic2() +
geom_sf(data = ICC_crop) +
geom_sf(data = ICC, fill = 'lavender') +
geom_label(data = ICC_centroids,
mapping = aes(x = X, y = Y, label = TOWN20),
size = 2, fill = 'white') +
# Add Scale Bar (bottom right default)
annotation_scale(location = "br", width_hint = 0.5) +
# Add North Arrow (top right default)
annotation_north_arrow(location = "tr", which_north = "true",
style = north_arrow_fancy_orienteering) +
theme(axis.line.y = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
axis.title = element_blank())
ggplot() + theme_classic2() +
geom_sf(data = ICC_crop) +
geom_sf(data = ICC, fill = 'lavender') +
geom_label(data = ICC_centroids,
mapping = aes(x = X, y = Y, label = TOWN20),
size = 2, fill = 'white') +
# Add Scale Bar (bottom right default)
annotation_scale(location = "br", width_hint = 0.5) +
# Add North Arrow (top right default)
annotation_north_arrow(location = "tr", which_north = "true",
style = north_arrow_fancy_orienteering) +
theme(axis.line.y = element_blank(),
axis.line.x = element_blank(),
axis.ticks = element_blank(),
axis.text = element_blank(),
axis.title = element_blank())
ggsave('map_v10.png', width = 7, height = 7, dpi = 300)
