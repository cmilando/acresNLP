name = 'Average proportion\n of hazard words\nreferencing hazard X\nacross reports') +
facet_rep_wrap(~name, nrow = 2, repeat.tick.labels = 'x') +
xlab(NULL) + ylab(NULL) +
theme(strip.background = element_blank(),
panel.background = element_rect(color = 'black'),
axis.text = element_blank(),
axis.ticks = element_blank()) +
d1
ggplot(ACRES_hazard_towns_plot %>%
filter(!is.na(value))) + theme_classic2() +
geom_sf(data = ma_counties_no_suffolk,
color = "black",
fill = "grey")+
geom_sf(mapping = aes(),
color = "black",
fill = "white") +
geom_sf(aes(fill = value)) +
scale_fill_binned(type = 'viridis',
name = 'Average proportion\n of hazard words\nreferencing hazard X\nacross reports') +
facet_rep_wrap(~name, nrow = 2, repeat.tick.labels = 'x') +
xlab(NULL) + ylab(NULL) +
theme(strip.background = element_blank(),
panel.background = element_rect(color = 'black'),
axis.text = element_blank(),
axis.ticks = element_blank()) +
d1
ggplot(ACRES_hazard_towns_plot %>%
filter(!is.na(value))) + theme_classic2() +
geom_sf(data = ma_counties_no_suffolk,
color = "black",
fill = "grey")+
geom_sf(mapping = aes(),
color = "black",
fill = "white") +
geom_sf(aes(fill = value)) +
scale_fill_binned(type = 'viridis',
name = 'Average proportion\n of hazard words\nreferencing hazard X\nacross reports') +
facet_rep_wrap(~name, nrow = 2, repeat.tick.labels = 'x') +
xlab(NULL) + ylab(NULL) +
theme(strip.background = element_blank(),
panel.background = element_rect(color = 'black'),
axis.text = element_blank(),
axis.ticks = element_blank())
ggplot(ACRES_hazard_towns_plot %>%
filter(!is.na(value))) + theme_classic2() +
geom_sf(data = ma_counties_no_suffolk,
color = "black",
fill = "grey")+
geom_sf(mapping = aes(),
color = "black",
fill = "white") +
geom_sf(aes(fill = value)) +
coord_sf(xlim = c(bbox_coords$xmin, bbox_coords$xmax),
ylim = c(bbox_coords$ymin, bbox_coords$ymax),
expand = FALSE) +  # Set plot bounds
scale_fill_binned(type = 'viridis',
name = 'Average proportion\n of hazard words\nreferencing hazard X\nacross reports') +
facet_rep_wrap(~name, nrow = 2, repeat.tick.labels = 'x') +
xlab(NULL) + ylab(NULL) +
theme(strip.background = element_blank(),
panel.background = element_rect(color = 'black'),
axis.text = element_blank(),
axis.ticks = element_blank())
ggplot(ACRES_hazard_towns_plot %>%
filter(!is.na(value))) + theme_classic2() +
geom_sf(data = ma_counties_no_suffolk,
color = "black",
fill = "grey")+
# geom_sf(mapping = aes(),
#         color = "black",
#         fill = "white") +
geom_sf(aes(fill = value)) +
coord_sf(xlim = c(bbox_coords$xmin, bbox_coords$xmax),
ylim = c(bbox_coords$ymin, bbox_coords$ymax),
expand = FALSE) +  # Set plot bounds
scale_fill_binned(type = 'viridis',
name = 'Average proportion\n of hazard words\nreferencing hazard X\nacross reports') +
facet_rep_wrap(~name, nrow = 2, repeat.tick.labels = 'x') +
xlab(NULL) + ylab(NULL) +
theme(strip.background = element_blank(),
panel.background = element_rect(color = 'black'),
axis.text = element_blank(),
axis.ticks = element_blank())
bbox_coords$xmin
ggplot(ACRES_hazard_towns_plot %>%
filter(!is.na(value))) + theme_classic2() +
geom_sf(data = ma_counties_no_suffolk,
color = "black",
fill = "grey")+
geom_sf(aes(fill = value)) +
coord_sf(xlim = c(bbox_coords$xmin * 0.95, bbox_coords$xmax * 1.05),
ylim = c(bbox_coords$ymin * 0.95, bbox_coords$ymax * 1.05),
expand = FALSE) +  # Set plot bounds
scale_fill_binned(type = 'viridis',
name = 'Average proportion\n of hazard words\nreferencing hazard X\nacross reports') +
facet_rep_wrap(~name, nrow = 2, repeat.tick.labels = 'x') +
xlab(NULL) + ylab(NULL) +
theme(strip.background = element_blank(),
panel.background = element_rect(color = 'black'),
axis.text = element_blank(),
axis.ticks = element_blank())
ggplot(ACRES_hazard_towns_plot %>%
filter(!is.na(value))) + theme_classic2() +
geom_sf(data = ma_counties_no_suffolk,
color = "black",
fill = "grey")+
geom_sf(aes(fill = value)) +
coord_sf(xlim = c(bbox_coords$xmin * 0.9995, bbox_coords$xmax * 1.0005),
ylim = c(bbox_coords$ymin * 0.9995, bbox_coords$ymax * 1.0005),
expand = FALSE) +  # Set plot bounds
scale_fill_binned(type = 'viridis',
name = 'Average proportion\n of hazard words\nreferencing hazard X\nacross reports') +
facet_rep_wrap(~name, nrow = 2, repeat.tick.labels = 'x') +
xlab(NULL) + ylab(NULL) +
theme(strip.background = element_blank(),
panel.background = element_rect(color = 'black'),
axis.text = element_blank(),
axis.ticks = element_blank())
ggplot(ACRES_hazard_towns_plot %>%
filter(!is.na(value))) + theme_classic2() +
geom_sf(data = ma_counties_no_suffolk,
color = "black",
fill = "grey")+
geom_sf(aes(fill = value)) +
coord_sf(xlim = c(bbox_coords$xmin - 0.0001, bbox_coords$xmax + 0.0001),
ylim = c(bbox_coords$ymin - 0.0001, bbox_coords$ymax + 0.0001),
expand = FALSE) +  # Set plot bounds
scale_fill_binned(type = 'viridis',
name = 'Average proportion\n of hazard words\nreferencing hazard X\nacross reports') +
facet_rep_wrap(~name, nrow = 2, repeat.tick.labels = 'x') +
xlab(NULL) + ylab(NULL) +
theme(strip.background = element_blank(),
panel.background = element_rect(color = 'black'),
axis.text = element_blank(),
axis.ticks = element_blank())
ggplot(ACRES_hazard_towns_plot %>%
filter(!is.na(value))) + theme_classic2() +
geom_sf(data = ma_counties_no_suffolk,
color = "black",
fill = "grey")+
geom_sf(aes(fill = value)) +
coord_sf(xlim = c(bbox_coords$xmin - 0.001, bbox_coords$xmax + 0.001),
ylim = c(bbox_coords$ymin - 0.001, bbox_coords$ymax + 0.001),
expand = FALSE) +  # Set plot bounds
scale_fill_binned(type = 'viridis',
name = 'Average proportion\n of hazard words\nreferencing hazard X\nacross reports') +
facet_rep_wrap(~name, nrow = 2, repeat.tick.labels = 'x') +
xlab(NULL) + ylab(NULL) +
theme(strip.background = element_blank(),
panel.background = element_rect(color = 'black'),
axis.text = element_blank(),
axis.ticks = element_blank())
ggplot(ACRES_hazard_towns_plot %>%
filter(!is.na(value))) + theme_classic2() +
geom_sf(data = ma_counties_no_suffolk,
color = "black",
fill = "grey")+
geom_sf(aes(fill = value)) +
coord_sf(xlim = c(bbox_coords$xmin - 0.01, bbox_coords$xmax + 0.01),
ylim = c(bbox_coords$ymin - 0.01, bbox_coords$ymax + 0.01),
expand = FALSE) +  # Set plot bounds
scale_fill_binned(type = 'viridis',
name = 'Average proportion\n of hazard words\nreferencing hazard X\nacross reports') +
facet_rep_wrap(~name, nrow = 2, repeat.tick.labels = 'x') +
xlab(NULL) + ylab(NULL) +
theme(strip.background = element_blank(),
panel.background = element_rect(color = 'black'),
axis.text = element_blank(),
axis.ticks = element_blank())
ggplot(ACRES_hazard_towns_plot %>%
filter(!is.na(value))) + theme_classic2() +
geom_sf(data = ma_counties_no_suffolk,
color = "black", linetype = '11',
fill = "grey")+
geom_sf(aes(fill = value)) +
coord_sf(xlim = c(bbox_coords$xmin - 0.01, bbox_coords$xmax + 0.01),
ylim = c(bbox_coords$ymin - 0.01, bbox_coords$ymax + 0.01),
expand = FALSE) +  # Set plot bounds
scale_fill_binned(type = 'viridis',
name = 'Average proportion\n of hazard words\nreferencing hazard X\nacross reports') +
facet_rep_wrap(~name, nrow = 2, repeat.tick.labels = 'x') +
xlab(NULL) + ylab(NULL) +
theme(strip.background = element_blank(),
panel.background = element_rect(color = 'black'),
axis.text = element_blank(),
axis.ticks = element_blank())
hazard_name_map = c(
"air_pollution_avg" = 'Air Pollution',
'chem_hazard_avg' = 'Chemical Hazards',
'extreme_precip_avg' = 'Extreme Precipitation',
'fire_avg' = 'Fire',
'flood_avg' = 'Flood',
'heat_avg' = 'Heat',
'indoor_air_avg' = 'Indoor Air',
'storm_avg' = 'Storm'
)
ACRES_hazard_towns_plot$haz_name_plot = hazard_name_map[ACRES_hazard_towns_plot$name]
ggplot(ACRES_hazard_towns_plot %>%
filter(!is.na(value))) + theme_classic2() +
geom_sf(data = ma_counties_no_suffolk,
color = "black", linetype = '11',
fill = "grey") +
geom_sf(aes(fill = value)) +
coord_sf(xlim = c(bbox_coords$xmin - 0.01, bbox_coords$xmax + 0.01),
ylim = c(bbox_coords$ymin - 0.01, bbox_coords$ymax + 0.01),
expand = FALSE) +  # Set plot bounds
scale_fill_binned(type = 'viridis',
name = 'Average proportion\nof hazard words\nreferencing hazard X\nacross reports') +
facet_rep_wrap(~haz_name_plot, nrow = 2, repeat.tick.labels = 'x') +
xlab(NULL) + ylab(NULL) +
theme(strip.background = element_blank(),
panel.background = element_rect(color = 'black'),
axis.text = element_blank(),
axis.ticks = element_blank())
ggplot(ACRES_hazard_towns_plot %>%
filter(!is.na(value))) + theme_classic2() +
geom_sf(data = ma_counties_no_suffolk,
color = "black", linetype = '11',
fill = "grey") +
geom_sf(aes(fill = value)) +
coord_sf(xlim = c(bbox_coords$xmin - 0.01, bbox_coords$xmax + 0.01),
ylim = c(bbox_coords$ymin - 0.01, bbox_coords$ymax + 0.01),
expand = FALSE) +  # Set plot bounds
scale_fill_binned(type = 'viridis',
name = 'Average proportion\nof hazard words\nreferencing hazard X\nacross reports') +
facet_rep_wrap(~haz_name_plot, nrow = 2, repeat.tick.labels = 'x') +
xlab(NULL) + ylab(NULL) +
theme(strip.background = element_blank(),
#panel.background = element_rect(color = 'black'),
axis.text = element_blank(),
axis.ticks = element_blank())
ggplot(ACRES_hazard_towns_plot %>%
filter(!is.na(value))) + theme_classic2() +
geom_sf(data = ma_counties_no_suffolk,
color = "black", linetype = '11',
fill = "grey") +
geom_sf(aes(fill = value)) +
coord_sf(xlim = c(bbox_coords$xmin - 0.01, bbox_coords$xmax + 0.01),
ylim = c(bbox_coords$ymin - 0.01, bbox_coords$ymax + 0.01),
expand = FALSE) +  # Set plot bounds
scale_fill_binned(type = 'viridis',
name = 'Average proportion\nof hazard words\nreferencing hazard X\nacross reports') +
facet_rep_wrap(~haz_name_plot, nrow = 2, repeat.tick.labels = 'x') +
xlab(NULL) + ylab(NULL) +
theme(strip.background = element_blank(),
panel.background = element_rect(color = 'black'),
axis.text = element_blank(),
axis.ticks = element_blank())
ggsave(device = 'png', dpi = 600, file = 'fig1.png')
ggplot(ACRES_hazard_towns_plot %>%
filter(!is.na(value))) + theme_classic2() +
geom_sf(data = ma_counties_no_suffolk,
color = "black", linetype = '11',
fill = "grey") +
geom_sf(aes(fill = value)) +
coord_sf(xlim = c(bbox_coords$xmin - 0.01, bbox_coords$xmax + 0.01),
ylim = c(bbox_coords$ymin - 0.01, bbox_coords$ymax + 0.01),
expand = FALSE) +  # Set plot bounds
scale_fill_binned(type = 'viridis',
name = 'Average per-document\nproportion of\nhazard words\nreferencing hazard X\n') +
facet_rep_wrap(~haz_name_plot, nrow = 2, repeat.tick.labels = 'x') +
xlab(NULL) + ylab(NULL) +
theme(strip.background = element_blank(),
panel.background = element_rect(color = 'black'),
axis.text = element_blank(),
axis.ticks = element_blank())
ggplot(ACRES_hazard_towns_plot %>%
filter(!is.na(value))) + theme_classic2() +
geom_sf(data = ma_counties_no_suffolk,
color = "black", linetype = '11',
fill = "grey") +
geom_sf(aes(fill = value)) +
coord_sf(xlim = c(bbox_coords$xmin - 0.01, bbox_coords$xmax + 0.01),
ylim = c(bbox_coords$ymin - 0.01, bbox_coords$ymax + 0.01),
expand = FALSE) +  # Set plot bounds
scale_fill_binned(type = 'viridis',
name = 'Average per-document\nproportion of\nhazard words\nreferencing hazard X\n') +
facet_rep_wrap(~haz_name_plot, nrow = 2, repeat.tick.labels = 'x') +
xlab(NULL) + ylab(NULL) +
theme(strip.background = element_blank(),
strip.text = element_text(size = 10),
panel.background = element_rect(color = 'black'),
axis.text = element_blank(),
axis.ticks = element_blank())
ggplot(ACRES_hazard_towns_plot %>%
filter(!is.na(value))) + theme_classic2() +
geom_sf(data = ma_counties_no_suffolk,
color = "black", linetype = '11',
fill = "grey") +
geom_sf(aes(fill = value)) +
coord_sf(xlim = c(bbox_coords$xmin - 0.01, bbox_coords$xmax + 0.01),
ylim = c(bbox_coords$ymin - 0.01, bbox_coords$ymax + 0.01),
expand = FALSE) +  # Set plot bounds
scale_fill_binned(type = 'viridis',
name = 'Average per-document\nproportion of\nhazard words\nreferencing hazard X\n') +
facet_rep_wrap(~haz_name_plot, nrow = 2, repeat.tick.labels = 'x') +
xlab(NULL) + ylab(NULL) +
theme(strip.background = element_blank(),
strip.text = element_text(size = 12),
panel.background = element_rect(color = 'black'),
axis.text = element_blank(),
axis.ticks = element_blank())
ggsave(device = 'png', dpi = 600, file = 'fig1.png',
width = 6, height = 4)
ggsave(device = 'png', dpi = 600, file = 'fig1.png',
width = 8, height = 6)
hazard_name_map = c(
"air_pollution_avg" = 'Air Pollution',
'chem_hazard_avg' = 'Chemical Hazards',
'extreme_precip_avg' = 'Extreme Precip.',
'fire_avg' = 'Fire',
'flood_avg' = 'Flood',
'heat_avg' = 'Heat',
'indoor_air_avg' = 'Indoor Air',
'storm_avg' = 'Storm'
)
ACRES_hazard_towns_plot$haz_name_plot = hazard_name_map[ACRES_hazard_towns_plot$name]
ggplot(ACRES_hazard_towns_plot %>%
filter(!is.na(value))) + theme_classic2() +
geom_sf(data = ma_counties_no_suffolk,
color = "black", linetype = '11',
fill = "grey") +
geom_sf(aes(fill = value)) +
coord_sf(xlim = c(bbox_coords$xmin - 0.01, bbox_coords$xmax + 0.01),
ylim = c(bbox_coords$ymin - 0.01, bbox_coords$ymax + 0.01),
expand = FALSE) +  # Set plot bounds
scale_fill_binned(type = 'viridis',
name = 'Average per-document\nproportion of\nhazard words\nreferencing hazard X\n') +
facet_rep_wrap(~haz_name_plot, nrow = 2, repeat.tick.labels = 'x') +
xlab(NULL) + ylab(NULL) +
theme(strip.background = element_blank(),
strip.text = element_text(size = 12),
panel.background = element_rect(color = 'black'),
axis.text = element_blank(),
axis.ticks = element_blank())
ggsave(device = 'png', dpi = 600, file = 'fig1.png',
width = 8, height = 6)
library(readr)
library(tidyverse)
library(ggforce)
library(janitor)
library(sf)
library(gtable)
library(grid)
library(gridExtra)
library(tigris)
library(leaflet)
### NOTES
# * STONEHAM HAS NO CLIMATE REPORTS
# * NOT A LOT OF ADJACENCY IN HAZARDS
#
# *
# * allison: for both hazards and outreach, for some towns the totals are < 100%
# * chad: expanding heat search terms and seeing if that changes things, manual search
# Needs:
# * Map
# * table of the heatmap with %s and n
# * REVERE AND LEXINGTON DON'T HAVE 100% in relevancy table
# * WHY ISNT HEAT MORE ** SEARCH TERMS
#
# * WHAT ABOUT THE COMMUNITY CONCERNS
# ----------------------------------------------------------------------------
#### create dataframe of hazard counts and proportions by town ####
#adjust based on your computer
# my_dir <- "/Users/allisonjames/Desktop/bu/acresNLP/"
my_dir <- "/Users/cwm/Documents/GitHub/acresNLP/"
create_df <- function(filename){
data <- read_delim(filename)
return(data)
}
#combined table missing all arlington/belmont and some chelsea/everett
combined_table <- create_df(paste0(my_dir, "combined_output1.tsv"))
combined_table <- combined_table %>% clean_names()
combined_table$town_name <- gsub("url\\d+|\\d+|\\.json", "",
combined_table$file_name)
combined_table$town_name <- toupper(combined_table$town_name)
View(combined_table)
combined_table <- combined_table %>%
mutate(towns_match = (town_name == toupper(most_common_town)))
#90% or over for all towns
combined_table_relevant <- combined_table %>%
filter(towns_match & relevant)
dim(combined_table_relevant)
dim(combined_table)
write_tsv(combined_table_relevant, 'combined_table_relevant.tsv')
library(readr)
library(tidyverse)
library(ggforce)
library(janitor)
library(sf)
library(gtable)
library(grid)
library(gridExtra)
library(tigris)
library(leaflet)
#adjust based on your computer
# my_dir <- "/Users/allisonjames/Desktop/bu/acresNLP/"
my_dir <- "/Users/cwm/Documents/GitHub/acresNLP/"
create_df <- function(filename){
data <- read_delim(filename)
return(data)
}
#combined table missing all arlington/belmont and some chelsea/everett
combined_table <- create_df(paste0(my_dir, "combined_output1.tsv"))
problems(combined_table)
head(combined_table)
data.frame(head(combined_table))
#combined table missing all arlington/belmont and some chelsea/everett
combined_table <- create_df(paste0(my_dir, "combined_output1.tsv"))
combined_table <- combined_table %>% clean_names()
combined_table$town_name <- gsub("url\\d+|\\d+|\\.json", "",
combined_table$file_name)
combined_table$town_name <- toupper(combined_table$town_name)
View(combined_table)
##
combined_table <- combined_table %>%
mutate(towns_match = (town_name == toupper(most_common_town)))
head(combined_table)
combined_table %>%
summarize(
total_pdfs = n(),
total_ma_url = sum(ma_url),
total_org_url = sum(org_url),
total_has_mass = sum(has_mass),
total_has_climate = sum(has_climate)
)
combined_table %>%
filter(ma_url == 1,
org_url ==1,
has_mass == 1,
has_climate ==1) %>%
group_by(town_name) %>% tally()
pass_checks <- combined_table %>%
filter(ma_url == 1,
org_url ==1,
has_mass == 1,
has_climate ==1) %>%
group_by(town_name) %>% tally()
sum(pass_checks$n)
pass_checks <- combined_table %>%
filter(ma_url == 1,
org_url ==1,
has_mass == 1,
has_climate ==1)
pass_checks
View(pass_checks)
write_tsv(pass_checks, 'pass_checks.tsv')
combined_table %>%
summarize(
total_pdfs = n(),
total_ma_url = sum(ma_url),
total_org_url = sum(org_url),
total_has_mass = sum(has_mass),
total_has_climate = sum(has_climate)
)
pass_checks <- combined_table %>%
filter(ma_url == 1,
org_url ==1,
has_mass == 1,
has_climate ==1,
towns_match == T) %>%
group_by(town_name) %>% tally()
sum(pass_checks$n)
combined_table %>%
summarize(
total_pdfs = n(),
total_ma_url = sum(ma_url),
total_org_url = sum(org_url),
total_has_mass = sum(has_mass),
total_has_climate = sum(has_climate),
total_towns_match = sum(towns_match)
)
pass_checks <- combined_table %>%
filter(#ma_url == 1,
org_url ==1,
has_mass == 1,
has_climate ==1,
towns_match == T) %>%
group_by(town_name) %>% tally()
sum(pass_checks$n)
pass_checks <- combined_table %>%
filter(#ma_url == 1,
org_url ==1,
has_mass == 1,
has_climate ==1,
towns_match == T)
pass_checks
View(pass_checks)
# ----------------------------------------------------------------------------
# ma.url omitted
combined_table %>%
summarize(
total_pdfs = n(),
total_org_url = sum(org_url),
total_has_mass = sum(has_mass),
total_has_climate = sum(has_climate),
total_towns_match = sum(towns_match)
)
pass_checks <- combined_table %>%
filter(org_url ==1,
has_mass == 1,
has_climate ==1,
towns_match == T) %>%
group_by(town_name) %>% tally()
sum(pass_checks$n)
pass_checks <- combined_table %>%
filter(
org_url ==1,
has_mass == 1,
has_climate ==1,
towns_match == T)
View(pass_checks)
